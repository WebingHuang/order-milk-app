(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/index"],{"0b7d":function(t,e,r){"use strict";(function(t,e){var n=r("4ea4");r("3afe");n(r("66fd"));var s=n(r("79cc"));t.__webpack_require_UNI_MP_PLUGIN__=r,e(s.default)}).call(this,r("bc2e")["default"],r("543d")["createPage"])},"36fc":function(t,e,r){"use strict";(function(t){var n=r("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=n(r("2ef0")),a={0:["取消订单","待付款"],1:["申请退款","查看未送牛奶"],2:["申请退款","查看未送牛奶"],3:["去复购"],4:["退款中"],5:["已退款"],6:["已关闭"]},i={data:function(){return{fixType:[1,5],list:[{name:"全部"},{name:"待付款"},{name:"未送完"},{name:"已送完"},{name:"退款"}],page:{status:"loadMore",pageNum:1,pageSize:10},current:"全部",Height:"",ordersList:[],orderStatus:""}},onLoad:function(e){var r=t.getStorageSync("current"),n=t.getStorageSync("orderStatus");r&&n&&(t.removeStorageSync("current"),t.removeStorageSync("orderStatus")),(e.current||e.orderStatus)&&(this.current=e.current,this.orderStatus=e.orderStatus),this.ordersList=[],this.getOrderList(),this.getAppHeight()},onHide:function(){t.setStorageSync("current",this.current),t.setStorageSync("orderStatus",this.orderStatus)},onShow:function(){var e=t.getStorageSync("current"),r=t.getStorageSync("orderStatus");e&&r&&(this.current=e,this.orderStatus=r,this.ordersList=[],this.getOrderList())},methods:{getOrderList:function(){var t=this,e=Object.assign({orderStatus:this.orderStatus},this.fixType.includes(this.orderStatus)?{type:1==this.orderStatus?1:2}:{});this.$u.api.findByOrders({pageRequest:{pageNum:this.page.pageNum,pageSize:this.page.pageSize},omsOrderVo:e}).then((function(e){e.records.forEach((function(e){t.ordersList.push(e),e.buts=t.getbuts(e.orderStatus)})),e.current==e.pages&&(t.page.status="noneMore")})).catch()},getbuts:function(t){switch(t){case"0":return a[t];case"1":return a[t];case"2":return a[t];case"3":return a[t];case"4":return a[t];case"5":return a[t];case"6":return a[t]}},handlerButt:s.default.debounce((function(t,e){switch(t){case"待付款":this.topaid(e);break;case"取消订单":this.cancelOrder(e);break;case"去复购":this.repurchase(e);break;case"查看未送牛奶":this.sendMilk(e);break;case"提醒发货":this.remindDelivery(e);break;case"确认收货":this.confirmReceipt(e);break;case"申请退款":this.tosales(e);break}}),1e3,{leading:!0,trailing:!1}),tosales:function(e){var r=-1;e.totalCanRefundNum<=0&&(r=2),3==e.payType?r=0:1==e.payType&&(r=1),r>-1?t.showModal({title:"提示",content:["该订单为月付订单，不可申请退款","该订单为先送后付订单，不可申请退款","该订单为可退数量为0，不可申请退款"][r],confirmColor:"black",showCancel:!1,confirmText:"确定",success:function(t){t.confirm&&console.log("没有操作")}}):t.navigateTo({url:"/pages/my/torefund?id="+e.id+"&orderSn="+e.orderSn+"&payAmount="+e.payAmount+"&omsOrderItemEntityList="+encodeURIComponent(JSON.stringify(e.omsOrderItemEntityList))+"&totalRefundAmount="+e.totalRefundAmount+"&totalCanRefundNum="+e.totalCanRefundNum})},handlerItem:function(e){"5"==e.orderStatus||"4"==e.orderStatus?t.navigateTo({url:"/pages/order/refundPage?list="+encodeURIComponent(JSON.stringify(e))}):t.navigateTo({url:"/pages/order/topaid?list="+encodeURIComponent(JSON.stringify(e))})},topaid:function(e){var r=[],n=[],s=[];e.omsOrderItemEntityList.map((function(t){r.push(t.spuId),n.push(t.skuId),s.push(t.skuQuantity)})),t.navigateTo({url:"/pages/order/confirmOrder?supId="+r.join(",")+"&skuId="+n.join(",")+"&num="+s.join(",")+"&orderSn="+e.orderSn+"&batchId="+e.batchId})},cancelOrder:function(e){var r=this;this.$u.api.updateStatus({orderSn:e.orderSn,orderStatus:"6",deliverySn:""}).then((function(e){t.showToast({title:"已取消订单"}),r.current="待付款",r.orderStatus="0",r.ordersList=[],r.getOrderList()})).catch()},repurchase:function(e){t.navigateTo({url:"/pages/commodity/info?id="+e.omsOrderItemEntityList[0].spuId})},sendMilk:function(e){console.log("未送牛奶",e),t.navigateTo({url:"/pages/order/unsentDetail?orderId="+e.id})},remindDelivery:function(){console.log("提醒发货")},confirmReceipt:function(e){var r=this,n=[];e.omsOrderItemEntityList.map((function(t){n.push(t.spuId)})),this.$u.api.confirmReceipt({orderSn:e.orderSn,spuId:n}).then((function(e){t.showToast({title:"确认收货"}),r.ordersList=[],r.current="全部",r.orderStatus="",r.getOrderList()})).catch()},checkLogistics:function(){console.log("查看物流")},change:function(t){switch(t.name){case"全部":this.current="全部";break;case"待付款":this.current="待付款";break;case"未送完":this.current="未送完";break;case"已送完":this.current="已送完";break;case"退款":this.current="退款";break}var e;e="待付款"===this.current?0:"未送完"===this.current?1:"已送完"===this.current?3:"退款"===this.current?5:"",this.orderStatus=e,this.ordersList=[],this.getOrderList()},handlerClick:function(t){switch(t.type){case"全部":this.current="全部";break;case"待付款":this.current="待付款";break;case"未送完":this.current="未送完";break;case"已送完":this.current="已送完";break}},onReachBottom:function(){"loadMore"===this.page.status&&(this.page.pageNum++,this.getOrderList())},getAppHeight:function(){this.Height=t.getSystemInfoSync().windowHeight+"px"}}};e.default=i}).call(this,r("543d")["default"])},"4ba0":function(t,e,r){"use strict";r.r(e);var n=r("36fc"),s=r.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){r.d(e,t,(function(){return n[t]}))}(a);e["default"]=s.a},"79cc":function(t,e,r){"use strict";r.r(e);var n=r("e220"),s=r("4ba0");for(var a in s)["default"].indexOf(a)<0&&function(t){r.d(e,t,(function(){return s[t]}))}(a);r("b8a6");var i=r("f0c5"),o=Object(i["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=o.exports},b8a6:function(t,e,r){"use strict";var n=r("f960"),s=r.n(n);s.a},e220:function(t,e,r){"use strict";r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return a})),r.d(e,"a",(function(){return n}));var n={uLoadmore:function(){return r.e("uview-ui/components/u-loadmore/u-loadmore").then(r.bind(null,"88fc"))}},s=function(){var t=this.$createElement;this._self._c},a=[]},f960:function(t,e,r){}},[["0b7d","common/runtime","common/vendor"]]]);